<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
</head>
<body>


<div class="layui-collapse" lay-accordion>

    <div class="layui-colla-item">
        <div class="layui-colla-title">
            <img> </img>
            <span>审核机构选择</span>
        </div>
        <div class="layui-colla-content  layui-show">
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label">选择框</label>
                    <div class="layui-input-block" style="width: 200px">
                        <select name="city" lay-verify="required">
                            <option value=""></option>
                            <option value="0">北京</option>
                            <option value="1">上海</option>
                            <option value="2">广州</option>
                            <option value="3">深圳</option>
                            <option value="4">杭州</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="layui-colla-item">
        <div class="layui-colla-title">
            <img>审核</img>
            <span>基本信息</span>
        </div>
        <div class="layui-colla-content layui-show">
            <form class="layui-form" action="">
                <div class="layui-form-item">
                    <label class="layui-form-label" style="width: 100px">单行输入框</label>
                    <div class="layui-input-block">
                        <input type="text" style="width: 200px" name="title" lay-verify="required|title"
                               autocomplete="off" placeholder="请输入标题"
                               class="layui-input">
                    </div>
                </div>
                <button class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
            </form>
        </div>
    </div>
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">人员信息</h2>
        <div class="layui-colla-content layui-show">人员信息内容区域</div>
    </div>

    <div>
        <div class="widget-body no-padding">
            <table id="dt-table" class="table table-striped table-bordered table-hover" style="width:100%">
                <thead>
                <tr>
                </tr>
                <tr>
                    <th>username</th>
                    <th>昵称</th>
                    <th>手机号</th>
                    <th>邮箱</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>


<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript">
    layui.use(['layer', 'form', 'element'], function () {
        var layer = layui.layer
            , form = layui.form;
        //自定义验证规则
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '标题至少得5个字符啊';
                }
            }
        });
        //提交验证
        form.on('submit(demo1)', function (data) {
            layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

    });
    var example;
    var pers = checkPermission();

    function init() {
        example =
            $('#dt-table').DataTable({
                "searching": false,
                "processing": false,
                "serverSide": true,
                "language": {
                    "url": "/js/plugin/datatables/Chinese.lang"
                },
                "ajax": {
                    "url": "/users",
                    "type": "get",
                    "data": function (d) {
                        d.username = $('#username').val();
                        d.nickname = $('#nickname').val();
                        d.status = $('#status').val();
                    },
                    "error": function (xhr, textStatus, errorThrown) {
                        var msg = xhr.responseText;
                        console.log(msg);
                        var response = JSON.parse(msg);
                        var code = response.code;
                        var message = response.message;
                        if (code == 400) {
                            layer.msg(message);
                        } else if (code == 401) {
                            localStorage.removeItem("token");
                            layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function () {
                                location.href = '/login.html';
                            });
                        } else if (code == 403) {
                            console.log("未授权:" + message);
                            layer.msg('未授权');
                        } else if (code == 500) {
                            layer.msg('系统错误：' + message);
                        }
                    }
                },
                "dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
                "columns": [
                    {"data": "username", "defaultContent": ""},
                    {"data": "nickname", "defaultContent": ""},
                    {"data": "phone", "defaultContent": ""},
                    {"data": "email", "defaultContent": ""},
                    {
                        "data": "status",
                        "defaultContent": "",
                        "render": function (data, type, row) {
                            return userStatus[data];
                        }
                    },
                    {
                        "data": "",
                        "defaultContent": "",
                        "orderable": false,
                        "render": function (data, type, row) {
                            var id = row['id'];
                            var href = "updateUser.html?id=" + id;
                            var edit = buttonEdit(href, "sys:user:add", pers);
                            return edit;
                        }
                    },

                ],
                "order": [[0, "desc"], [1, "asc"]]
            });
    }
    init();

</script>
</body>
</html>